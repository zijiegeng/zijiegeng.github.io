import{f as S,K as A,L as H,E as D,e as d,n as k,g as M,t as b,z as B,r as _,o as h,p as N}from"../modules/vue-B4QAKlIR.js";import{C as $}from"../index-DrKhBKue.js";const I=["innerHTML"],P=["textContent"],T=["textContent"],v="slidev-note-fade",i="slidev-note-click-mark",R=S({__name:"NoteDisplay",props:{class:{},noteHtml:{},note:{},highlight:{type:Boolean,default:!0},placeholder:{},clicksContext:{},autoScroll:{type:Boolean}},emits:["markerDblclick","markerClick"],setup(a,{emit:E}){const l=a,g=E,C=B(()=>l.clicksContext!=null&&l.noteHtml?.includes(i)),r=_(null);function x(){if(!r.value||!C.value)return;const f=Array.from(r.value.querySelectorAll(`.${i}`)),u=new Map,c=new Map;let w=0;for(const s of f){const o=Number(s.dataset.clicks);u.set(s,o);let t=s,e=s.parentElement;for(;e&&t!==r.value;)c.has(e)||c.set(e,[[null,w]]),c.get(e).push([t,o]),t=e,e=e.parentElement;w=o}const L=new Map;for(const[s,o]of c){let t=!1,e=0;for(const n of Array.from(s.childNodes)){let p=!1;for(;n===o[e+1]?.[0];)p=!0,e++;if(p)continue;let m=n;if(n.nodeType===3){if(!n.textContent?.trim())continue;m=document.createElement("span"),m.textContent=n.textContent,s.insertBefore(m,n),n.remove()}t||=e===0,L.set(m,o[e][1])}t||(o[0][1]=-1)}return s=>{const o=l.highlight;for(const[t,e]of c)t.classList.toggle(v,o&&!e.some(([n,p])=>p===s));for(const[t,e]of L)t.classList.toggle(v,o&&e!==s);for(const[t,e]of u)t.classList.remove(v),t.classList.toggle(`${i}-past`,o&&e<s),t.classList.toggle(`${i}-active`,o&&e===s),t.classList.toggle(`${i}-next`,o&&e===s+1),t.classList.toggle(`${i}-future`,o&&e>s+1),t.ondblclick=n=>{o&&(g("markerDblclick",n,e),!n.defaultPrevented&&(l.clicksContext.current=e,n.stopPropagation(),n.stopImmediatePropagation()))},t.onclick=n=>{o&&g("markerClick",n,e)},o&&l.autoScroll&&e===s&&t.scrollIntoView({block:"center",behavior:"smooth"})}}const y=_();return A(()=>[l.noteHtml,l.highlight],()=>{N(()=>{y.value=x()})},{immediate:!0}),H(()=>{x()}),D(()=>{const f=l.clicksContext?.current??$;y.value?.(f)}),(f,u)=>a.noteHtml?(h(),d("div",{key:0,ref_key:"noteDisplay",ref:r,class:k(["prose dark:prose-invert overflow-auto outline-none slidev-note",[l.class,C.value?"slidev-note-with-clicks":""]]),innerHTML:a.noteHtml},null,10,I)):a.note?(h(),d("div",{key:1,class:k(["prose dark:prose-invert overflow-auto outline-none slidev-note",l.class])},[M("p",{textContent:b(a.note)},null,8,P)],2)):(h(),d("div",{key:2,class:k(["prose dark:prose-invert overflow-auto outline-none opacity-50 italic select-none slidev-note",l.class])},[M("p",{textContent:b(l.placeholder||"No notes.")},null,8,T)],2))}});export{R as _};
